<ion-header>

    <ion-navbar color="primary">
        <button ion-button menuToggle>
            <ion-icon name="menu"></ion-icon>
        </button>
        <ion-title>{{'dashboard'|translate}}</ion-title>
    </ion-navbar>

</ion-header>


<ion-content>

    <ion-grid>
        <!-- loading area -->
        <div *ngIf="loading$ | async">
            <loading [loadingMessage]="'loading_dashboard'|translate" [loadingSize]="'large'"></loading>
        </div>
        <!-- end of loading area -->

        <div *ngIf="!(loading$ |async)">
            <!-- header section -->
            <div class="entry-selection-container " (tap)="openDashboardListFilter()">
                <ion-row>
                    <ion-col col-11>
                        {{ (currentDashboard$ | async)?.name }}
                    </ion-col>
                    <ion-col col-1>
                        <img [src]="icons['menu']" width="20" height="20">
                    </ion-col>
                </ion-row>
            </div>
            <!-- end of header section -->

            <!-- no dashboard section -->
            <div *ngIf="(visualizationObjects$ | async).length == 0">
                <empty-list-notification [emptyListMessage]="'there_no_dashboard_item_found'|translate"></empty-list-notification>
            </div>
            <!-- end of no dashboard section -->

            <!--cards for visualization -->
            <div class="dashboard-card" *ngFor="let visualizationObject of visualizationObjects$ | async">

                <!-- visualization card title section -->
                <ion-row (tap)="toggleVisualization(visualizationObject)" style="padding-top : 2px; padding-bottom: 2px">
                    <ion-col col-11>
                        <ion-icon color="primary">
                            <img class="dashboard-item-icon" [src]="icons[visualizationObject.details.currentVisualization]" />
                        </ion-icon>
                        <span ion-text [color]="(visualizationObject.details.expanded) ?'current' : 'font-color'">
                            {{ visualizationObject.name }}
                        </span>
                    </ion-col>
                    <ion-col col-1 item>
                        <div style="text-align: center;">
                            <ion-icon *ngIf="!visualizationObject.details.expanded" name="ios-arrow-down" [color]="(visualizationObject.details.expanded) ?'current' : 'font-color'"
                                item-right></ion-icon>
                            <ion-icon *ngIf="visualizationObject.details.expanded" name="ios-arrow-up" [color]="(visualizationObject.details.expanded) ?'current' : 'font-color'"
                                item-right></ion-icon>
                        </div>
                    </ion-col>
                </ion-row>
                <!-- end of visualization card title section -->

                <!-- visualization card body section -->
                <div *ngIf="visualizationObject.details.expanded">
                    <ion-row *ngIf="visualizationObject.details.loaded">
                        <ion-col>
                            <div class="visualization-card-header" *ngIf="!visualizationObject.details.nonVisualizable">
                                <div class="visualization-card-header-left">
                                    <div class="visualization-filter-section-container">
                                        <app-visualization-filter-section [selectedDimensions]="getSelectedDimensions(visualizationObject)" [visualizationType]="visualizationObject.details.currentVisualization"
                                            [loaded]="visualizationObject.details.loaded" (onFilterUpdate)="onFilterUpdate($event,visualizationObject)"
                                            (onLayoutUpdate)="onLayoutUpdate($event,visualizationObject)"></app-visualization-filter-section>
                                    </div>
                                </div>
                                <div style="right:1" (click)="openDashboardInFullScreen(visualizationObject)">
                                    <button class="dashboard-btn full-screen-dashboard-item-resize">
                                        <img src="assets/icon/full-screen.png" alt="">
                                    </button>
                                </div>
                            </div>
                        </ion-col>
                    </ion-row>
                    <ion-row>
                        <ion-col></ion-col>
                    </ion-row>
                    <ion-row>
                        <ion-col>
                            <div class="visualization-card-body">
                                <div class="visualization-block" [style.flex]="'2'">
                                    <!-- visualization card loading section -->
                                    <div *ngIf="!visualizationObject.details.loaded">
                                        <!-- <loading [loadingSize]="'large'" [loadingMessage]="'loading_visualization'|translate"></loading> -->
                                        <app-visualization-card-loader [visualizationType]="visualizationObject.details.currentVisualization"></app-visualization-card-loader>
                                    </div>
                                    <!-- end of visualization card loading section -->

                                    <!-- visualization card error message section -->
                                    <div *ngIf="visualizationObject.details.loaded && visualizationObject.details.hasError">
                                        <warning [warningMessage]="visualizationObject.details.ErrorMessage"></warning>
                                    </div>
                                    <!-- end of visualization card error message section -->

                                    <div *ngIf="visualizationObject.details.loaded && !visualizationObject.details.hasError" class="dashboard-card-body">
                                        <dashboard-visualization-card [visualizationObject]="visualizationObject"></dashboard-visualization-card>
                                    </div>

                                    <!-- visualization interpretation -->
                                    <div *ngIf="opendeInterpreationsMapper[visualizationObject.id] ">
                                        <div class="interpretation-container " *ngIf="visualizationObject.details.loaded
                                            && !visualizationObject.details.hasError && !visualizationObject.details.nonVisualizable ">
                                            <div class="interpretation-list " *ngFor="let layer of visualizationObject.layers ">
                                                <app-interpretation-list [interpretations]="layer.interpretation.interpretations
                                            " [visualizationTypeObject]="{id: layer.interpretation.id, type: layer.interpretation.type} "
                                                    [currentUser]="currentUser$ | async " [rootUrl]=" ''
                                            " [itemHeight]=" '100px' "></app-interpretation-list>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- end of visualization interpretation -->
                                </div>
                            </div>
                        </ion-col>

                        <div class="visualization-card-footer " *ngIf="visualizationObject.details.loaded ">
                            <div *ngIf="visualizationObject.details.nonVisualizable ">&nbsp;</div>
                            <div class="visualization-card-footer-left " *ngIf="!visualizationObject.details.nonVisualizable ">
                                <app-visualization-types-section (onToggleInterpretation)="toggleInterpretation(visualizationObject)
                                            " [currentVisualization]="visualizationObject.details.currentVisualization "
                                    (onCurrentVisualizationChange)="currentVisualizationChange($event,visualizationObject) "></app-visualization-types-section>
                            </div>
                        </div>
                    </ion-row>
                    <!-- end of visualization card body section -->
                </div>


            </div>
        </div>
    </ion-grid>
</ion-content>